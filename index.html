<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv='cache-control' content='no-cache'> 
    <meta http-equiv='expires' content='0'> 
    <meta http-equiv='pragma' content='no-cache'>
    <title>Galactic Trader: Deep Space</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <!-- =========================================
         1. LOADING SCREEN
    ========================================== -->
    <div id="loading-screen" class="loading-screen" style="display: none;">
        <div class="loading-content">
            <h2>GENERATING GALAXY</h2>
            <div id="loading-text">Initializing stellar cartography...</div>
            <div class="progress-container">
                <div id="progress-bar" class="progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- =========================================
         2. ENCOUNTER MODAL (Combat/Events)
    ========================================== -->
    <div id="encounter-modal" class="modal-overlay" style="display: none;">
        <div class="encounter-container">
            <div class="encounter-header">
                <i id="encounter-icon" class="fas fa-exclamation-circle"></i>
                <h2 id="encounter-title">ENCOUNTER</h2>
            </div>
            <div id="encounter-content" class="encounter-body">
                <!-- Dynamic Content injected by EncounterManager.js -->
            </div>
            <div id="encounter-log" class="combat-log"></div>
            <div id="encounter-options" class="combat-options">
                <!-- Dynamic Buttons injected by EncounterManager.js -->
            </div>
        </div>
    </div>

    <!-- =========================================
         3. GALAXY MAP MODAL (The Optimized Map)
    ========================================== -->
    <div id="galaxy-map-modal" class="galaxy-map-modal" style="display: none;">
        <div class="map-widget-container">
            <div class="map-header">
                <h2>GALACTIC CHART</h2>
                <button id="close-map-btn" class="btn-close"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="map-canvas-wrapper">
                <!-- Separate canvas for the full map view -->
                <canvas id="full-galaxy-canvas"></canvas>
                
                <!-- Map UI Overlays -->
                <div class="map-controls-overlay">
                    <!-- Search Box -->
                    <div class="search-container">
                        <input type="text" id="map-search-input" placeholder="Search System..." list="discovered-systems-list" autocomplete="off">
                        <button id="map-search-btn" class="btn"><i class="fas fa-search"></i></button>
                        <datalist id="discovered-systems-list"></datalist>
                    </div>
                    
                    <!-- Info Box for Selected System -->
                    <div id="map-selected-info" class="map-info-box">
                        <div class="info-details"></div>
                        <button id="set-target-btn" class="btn btn-action" disabled>SET COURSE</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- =========================================
         4. GAME OVER SCREEN
    ========================================== -->
    <div id="game-over-screen" class="game-over-screen" style="display: none;">
        <div class="game-over-box">
            <h1 style="color: #ff4444; margin-bottom: 10px;">CRITICAL FAILURE</h1>
            <p style="color: #aaa; margin-bottom: 30px;">Your ship has been destroyed.</p>
            
            <div class="game-over-stats">
                <div>Credits Earned: <span id="game-over-credits" style="color: #66ff99;">0</span></div>
                <div>Distance Traveled: <span id="game-over-distance" style="color: #66ccff;">0</span></div>
                <div>Systems Visited: <span id="game-over-systems">0</span></div>
            </div>
            
            <button id="new-game-btn" class="btn btn-action" style="width: 100%; margin-top: 20px;">INITIALIZE NEW SHIP</button>
        </div>
    </div>

    <!-- =========================================
         5. MAIN APPLICATION CONTAINER
    ========================================== -->
    <div class="app-container">
        
        <!-- A. INITIALIZATION SCREEN (Start Menu) -->
        <div id="init-screen" class="init-screen">
            <h1 class="game-title" style="font-size: 3rem; margin-bottom: 10px; color: #66ccff;">GALACTIC<br>TRADER</h1>
            <p class="subtitle" style="color: #88aaff; letter-spacing: 3px; margin-bottom: 40px;">DEEP SPACE EDITION</p>
            
            <div class="setup-box">
                <h3 style="margin-bottom: 15px; color: #fff;">SELECT GALAXY SIZE</h3>
                
                <div class="galaxy-size-selector">
                    <div class="size-option selected" data-size="1000">
                        <div class="icon"><i class="fas fa-star"></i></div>
                        <div class="label">Small</div>
                        <div class="detail">1,000 Systems</div>
                    </div>
                    <div class="size-option" data-size="5000">
                        <div class="icon"><i class="fas fa-atom"></i></div>
                        <div class="label">Medium</div>
                        <div class="detail">5,000 Systems</div>
                    </div>
                    <div class="size-option" data-size="50000">
                        <div class="icon"><i class="fas fa-galaxy"></i></div>
                        <div class="label">Massive</div>
                        <div class="detail">50,000 Systems</div>
                    </div>
                </div>
                
                <div class="galaxy-shape-selector">
                    <div class="shape-option selected" data-shape="balanced">Balanced</div>
                    <div class="shape-option" data-shape="wide">Wide</div>
                    <div class="shape-option" data-shape="tall">Tall</div>
                </div>

                <button id="start-game-btn" class="btn btn-action" style="margin-top: 25px; width: 100%; padding: 15px;">LAUNCH SYSTEMS</button>
            </div>
        </div>

        <!-- B. MAIN GAME INTERFACE (Hidden until start) -->
        <div id="game-content" class="game-interface" style="display: none;">
            
            <!-- LEFT PANEL: MAP & VIEWPORT (Local View) -->
            <div class="map-container">
                <canvas id="galaxy-canvas"></canvas>
                
                <div id="system-container"></div> 
                <div id="ship-container"></div>
                
                <div id="target-pointer" class="target-pointer" style="display: none;">
                    <div class="pointer-arrow"><i class="fas fa-chevron-up"></i></div>
                    <div class="pointer-info">
                        <span id="pointer-name">Target</span>
                        <span id="pointer-dist">0 LY</span>
                    </div>
                </div>

                <div id="hover-pointer" class="target-pointer" style="display: none; z-index: 150;">
                    <div class="hover-details"></div>
                </div>

                <div id="notification" class="notification"></div>
                <div class="crt-overlay"></div>
                <div class="map-center-btn" title="Center on Ship"><i class="fas fa-crosshairs"></i></div>
            </div>

            <!-- RIGHT PANEL: UI CONTROLS -->
            <div class="ui-panel">
                <div class="tabs">
                    <div class="tab active" data-tab="status"><i class="fas fa-tachometer-alt"></i> Status</div>
                    <div class="tab" data-tab="market"><i class="fas fa-shopping-cart"></i> Market</div>
                    <div class="tab" data-tab="cargo"><i class="fas fa-box"></i> Cargo</div>
                    <div class="tab" data-tab="shipyard"><i class="fas fa-rocket"></i> Ship</div>
                    <div class="tab" data-tab="overview"><i class="fas fa-globe"></i> System</div>
                    <div class="tab" data-tab="contracts"><i class="fas fa-file-contract"></i> Jobs</div>
                </div>

                <div class="tab-content">
                    
                    <!-- 1. STATUS TAB -->
                    <div class="panel-section status-tab">
                        <h2><i class="fas fa-space-shuttle"></i> SHIP STATUS</h2>
                        <div class="stats-grid">
                            <div class="stat">
                                <span>Credits:</span>
                                <span class="stat-value" id="credits" style="color: #66ff99;">0 CR</span>
                            </div>
                            <div class="stat">
                                <span>Fuel:</span>
                                <span class="stat-value" id="fuel">0/0</span>
                            </div>
                            <div class="stat">
                                <span>Hull:</span>
                                <span class="stat-value" id="hull" style="color: #ff6666;">100%</span>
                            </div>
                            <div class="stat">
                                <span>Cargo:</span>
                                <span class="stat-value" id="cargo-space">0/0</span>
                            </div>
                        </div>

                        <h2 style="margin-top: 15px;"><i class="fas fa-crosshairs"></i> NAVIGATION</h2>
                        <div class="nav-computer">
                            <div class="stat">
                                <span>Target:</span> <span class="stat-value" id="target-system" style="color: #ffcc66;">None</span>
                            </div>
                            <div class="stat">
                                <span>Distance:</span> <span class="stat-value" id="distance">0 LY</span>
                            </div>
                            <div class="stat">
                                <span>Fuel Cost:</span> <span class="stat-value" id="fuel-cost">0</span>
                            </div>
                            
                            <div class="mobile-controls" style="margin-top: 10px;">
                                <button id="travel-btn" class="btn btn-action mobile-btn">ENGAGE</button>
                                <button id="refuel-btn" class="btn mobile-btn">REFUEL</button>
                            </div>
                            
                            <!-- NEW BUTTON: LONG-RANGE SCAN -->
                            <!-- Hidden by default (display: none), controlled by UI.js based on radar level -->
                            <button id="scan-btn" class="btn mobile-btn" style="width: 100%; margin-top: 10px; display: none; background: rgba(176, 136, 255, 0.15); border-color: rgba(176, 136, 255, 0.5); color: #b088ff;">
                                <i class="fas fa-satellite-dish"></i> LONG-RANGE SCAN
                            </button>
                            
                            <!-- The Button to Open the Full Map -->
                            <button id="open-map-btn" class="btn mobile-btn" style="width: 100%; margin-top: 10px; background: #334466;">
                                <i class="fas fa-map"></i> OPEN GALAXY MAP
                            </button>
                        </div>
                    </div>

                    <!-- 2. MARKET TAB -->
                    <div class="panel-section market-tab" style="display: none;">
                        <h2><i class="fas fa-coins"></i> COMMODITIES</h2>
                        <div class="market-grid"></div>
                    </div>

                    <!-- 3. CARGO TAB -->
                    <div class="panel-section cargo-tab" style="display: none;">
                        <h2><i class="fas fa-boxes"></i> CARGO HOLD</h2>
                        <div class="cargo-item" style="font-weight: bold; border-bottom: 1px solid #445; color: #88aaff; font-size: 11px;">
                            <span>ITEM</span>
                            <span>QTY</span>
                            <span>ACTION</span>
                        </div>
                        <div id="cargo-hold"></div>
                    </div>

                    <!-- 4. SHIPYARD TAB -->
                    <div class="panel-section shipyard-tab" style="display: none;">
                        <h2><i class="fas fa-tools"></i> UPGRADES</h2>
                        <div id="shipyard-status" style="margin-bottom: 10px; color: #aaa; font-style: italic; font-size: 12px;"></div>
                        <div id="ship-upgrades"></div>
                    </div>

                    <!-- 5. SYSTEM OVERVIEW TAB -->
                    <div class="panel-section overview-tab" style="display: none;">
                        <h2><i class="fas fa-info-circle"></i> SYSTEM INTEL</h2>
                        <div class="system-overview-grid">
                            <div class="system-overview-item">
                                <h3 id="current-system-name" style="color: #66ccff; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px;">Unknown</h3>
                                <div id="current-system-economy">Economy: -</div>
                                <div id="current-system-security">Security: -</div>
                            </div>
                            <div class="system-overview-item">
                                <h3>Resources</h3>
                                <div id="overview-fuel">Fuel: -</div>
                                <div id="overview-refuel-cost">Refuel: -</div>
                            </div>
                            <div class="system-overview-item">
                                <h3>Logistics</h3>
                                <div id="overview-cargo">Cargo: -</div>
                                <div id="overview-cargo-value">Value: -</div>
                            </div>
                            <div class="system-overview-item">
                                <h3>Danger</h3>
                                <div id="overview-threat">Threat: -</div>
                                <div id="overview-pirate-chance">Risk: -</div>
                            </div>
                        </div>
                        <h3 style="margin-top: 15px; font-size: 12px; border-bottom: 1px solid #445; color: #88aaff;">NEARBY SYSTEMS</h3>
                        <div id="nearby-systems"></div>
                    </div>

                    <!-- 6. CONTRACTS TAB -->
                    <div class="panel-section contracts-tab" style="display: none;">
                        <h2><i class="fas fa-file-contract"></i> AVAILABLE CONTRACTS</h2>
                        <div id="contracts-list"></div>
                    </div>

                </div> <!-- End Tab Content -->
            </div> <!-- End UI Panel -->
        </div> <!-- End Game Content -->
    </div> <!-- End App Container -->

    <!-- Main Entry Point -->
    <script type="module" src="Game.js"></script>
</body>
</html>