<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv='cache-control' content='no-cache'> 
    <meta http-equiv='expires' content='0'> 
    <meta http-equiv='pragma' content='no-cache'>
    <title>Galactic Trader Mobile</title>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jonycase/fa6icons@main/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/mithril/mithril.js"></script>
</head>
<body>
    <div id="app"></div>
    
    <!-- Galaxy Map Widget (New) -->
    <div id="galaxy-map-modal" class="galaxy-map-modal" style="display: none;">
        <div class="map-widget-container">
            <div class="map-header">
                <h2><i class="fas fa-map-marked-alt"></i> GALAXY MAP</h2>
                <button id="close-map-btn" class="btn-close"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="map-canvas-wrapper">
                <canvas id="full-galaxy-canvas"></canvas>
                
                <!-- Controls floating inside the canvas area -->
                <div class="map-controls-overlay">
                    <div class="search-container">
                        <input type="text" id="map-search-input" placeholder="System Name..." list="discovered-systems-list">
                        <datalist id="discovered-systems-list"></datalist>
                        <button id="map-search-btn" class="btn small"><i class="fas fa-search"></i></button>
                    </div>
                    
                    <div class="map-info-box" id="map-selected-info">
                        <div class="info-title" style="color: #ffcc66; border-bottom: 1px solid #555; padding-bottom: 3px;">SELECT TARGET</div>
                        <div class="info-details" style="font-size: 13px; line-height: 1.4; color: #ccc;">--</div>
                        <button id="set-target-btn" class="btn btn-action small" style="margin-top: 5px; width: 100%;" disabled>SET COURSE</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen" style="display: none;">
        <div style="font-size: 24px; margin-bottom: 20px;">Generating Galaxy...</div>
        <div id="loading-text" style="font-size: 16px; margin-bottom: 10px;">Initializing</div>
        <div style="width: 80%; height: 20px; background: #222255; border-radius: 10px; overflow: hidden; max-width: 300px;">
            <div id="progress-bar" style="height: 100%; background: linear-gradient(90deg, #3388ff, #66ccff); width: 0%; transition: width 0.3s;"></div>
        </div>
        <div id="generation-info" class="generation-info" style="margin-top: 15px; font-size: 14px;"></div>
    </div>
    
    <!-- Unified Encounter Modal -->
    <div id="encounter-modal" class="encounter-modal">
        <div class="encounter-container">
            <h2><i class="fas" id="encounter-icon"></i> <span id="encounter-title"></span></h2>
            <div id="encounter-content">
                <!-- Dynamic content based on encounter type -->
            </div>
            <div id="encounter-log" style="height: 80px; overflow-y: auto; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 8px; margin: 12px 0; font-size: 14px;"></div>
            <div id="encounter-options" class="combat-options"></div>
        </div>
    </div>
    
    <!-- Game Over Screen -->
    <div id="game-over-screen" class="game-over-screen" style="display: none;">
        <h2>YOUR SHIP IS DESTROYED</h2>
        <div class="game-over-stats">
            <div>Credits: <span id="game-over-credits">0 CR</span></div>
            <div>Distance Traveled: <span id="game-over-distance">0 LY</span></div>
            <div>Systems Visited: <span id="game-over-systems">0</span></div>
        </div>
        <button id="new-game-btn" class="btn btn-action">START NEW GAME</button>
    </div>
    
    <!-- Main Game Container -->
    <div class="game-container">
        <!-- Init Screen -->
        <div id="init-screen" class="init-screen">
            <h2>CREATE YOUR GALAXY</h2>
            <p>Select the size of your trading galaxy:</p>
            <div class="galaxy-size-selector">
                <div class="size-option" data-size="1000">
                    <h3><i class="fas fa-star"></i> SMALL GALAXY</h3>
                    <p>1000 Star Systems</p>
                    <p>Perfect for beginners</p>
                </div>
                <div class="size-option" data-size="3200">
                    <h3><i class="fas fa-stars"></i> MEDIUM GALAXY</h3>
                    <p>3200 Star Systems</p>
                    <p>Balanced challenge</p>
                </div>
                <div class="size-option" data-size="48000">
                    <h3><i class="fas fa-galaxy"></i> VAST GALAXY</h3>
                    <p>48000 Star Systems</p>
                    <p>For experienced traders</p>
                </div>
            </div>
            
            <div class="galaxy-shape-selector" style="margin-top: 20px;">
                <h3>Galaxy Shape</h3>
                <div class="shape-option selected" data-shape="balanced">Balanced</div>
                <div class="shape-option" data-shape="wide">Wide</div>
                <div class="shape-option" data-shape="tall">Tall</div>
            </div>
            
            <div style="margin-top: 30px; font-size: 14px; color: #88aaff;">
                <p><i class="fas fa-info-circle"></i> Click on a galaxy size to start</p>
            </div>
        </div>
        
        <!-- Game Content (hidden by default) -->
        <div id="game-content" class="main-content" style="display: none;">
            <div class="map-container">
                <canvas id="galaxy-canvas" width="800" height="600"></canvas>
                <div id="system-container"></div>
                <div id="ship-container"></div>
                
                <!-- Target Pointer Overlay (New) -->
                <div id="target-pointer" class="target-pointer" style="display: none;">
                    <div class="pointer-arrow"><i class="fas fa-chevron-up"></i></div>
                    <div class="pointer-info">
                        <span id="pointer-name">Target</span>
                        <span id="pointer-dist">0 LY</span>
                    </div>
                </div>

                <div class="crt-overlay"></div>
                <div id="notification" class="notification"></div>
                <div id="system-info-panel" class="system-info-panel"></div>
            </div>
            <div class="ui-panel">
                <div class="tabs">
                    <div class="tab active" data-tab="status"><i class="fas fa-info-circle"></i> Status</div>
                    <div class="tab" data-tab="market"><i class="fas fa-shopping-cart"></i> Market</div>
                    <div class="tab" data-tab="cargo"><i class="fas fa-box-open"></i> Cargo</div>
                    <div class="tab" data-tab="shipyard"><i class="fas fa-rocket"></i> Ship</div>
                    <div class="tab" data-tab="overview"><i class="fas fa-globe"></i> Overview</div>
                    <div class="tab" data-tab="contracts"><i class="fas fa-file-contract"></i> Contracts</div>
                </div>
                <div class="tab-content">
                    <!-- Status Tab -->
                    <div class="panel-section status-tab">
                        <h2><i class="fas fa-space-shuttle"></i> SHIP STATUS</h2>
                        <div class="stats-grid">
                            <div class="stat">
                                <span>Credits:</span>
                                <span class="stat-value" id="credits">10,000 CR</span>
                            </div>
                            <div class="stat">
                                <span>Fuel:</span>
                                <span class="stat-value" id="fuel">15/15</span>
                            </div>
                            <div class="stat">
                                <span>Cargo Space:</span>
                                <span class="stat-value" id="cargo-space">0/50</span>
                            </div>
                            <div class="stat">
                                <span>Hull:</span>
                                <span class="stat-value" id="hull">100%</span>
                            </div>
                        </div>
                        <h2 style="margin-top: 15px;"><i class="fas fa-bullseye"></i> TARGET SYSTEM</h2>
                        <div class="stats-grid">
                            <div class="stat">
                                <span>Selected:</span>
                                <span class="stat-value" id="target-system">None</span>
                            </div>
                            <div class="stat">
                                <span>Distance:</span>
                                <span class="stat-value" id="distance">0 LY</span>
                            </div>
                            <div class="stat">
                                <span>Fuel Cost:</span>
                                <span class="stat-value" id="fuel-cost">0</span>
                            </div>
                        </div>
                        <div class="mobile-controls" style="flex-wrap: wrap;">
                            <button id="travel-btn" class="btn btn-action mobile-btn" style="flex: 1 0 45%;">
                                <i class="fas fa-space-shuttle"></i> TRAVEL
                            </button>
                            <button id="refuel-btn" class="btn mobile-btn" style="flex: 1 0 45%;">
                                <i class="fas fa-gas-pump"></i> REFUEL
                            </button>
                            <!-- New Map Button -->
                            <button id="open-map-btn" class="btn mobile-btn" style="flex: 1 0 100%; margin-top: 5px; background: linear-gradient(to bottom, #336699, #224466);">
                                <i class="fas fa-map-marked-alt"></i> OPEN GALAXY MAP
                            </button>
                        </div>
                    </div>
                    <!-- Market Tab -->
                    <div class="panel-section market-tab" style="display: none;">
                        <h2><i class="fas fa-coins"></i> LOCAL MARKET</h2>
                        <div class="market-grid">
                            <div class="market-header">COMMODITY</div>
                            <div class="market-header">BUY</div>
                            <div class="market-header">SELL</div>
                            <div class="market-header">STOCK</div>
                            <div class="market-header">ACTIONS</div>
                        </div>
                    </div>
                    <!-- Cargo Tab -->
                    <div class="panel-section cargo-tab" style="display: none;">
                        <h2><i class="fas fa-boxes"></i> CARGO HOLD</h2>
                        <div class="cargo-item" style="font-weight: bold;">
                            <span>ITEM</span>
                            <span>QTY</span>
                            <span>SELL</span>
                        </div>
                        <div id="cargo-hold">
                            <!-- Filled dynamically -->
                        </div>
                    </div>
                    <!-- Shipyard Tab -->
                    <div class="panel-section shipyard-tab" style="display: none;">
                        <h2><i class="fas fa-hard-hat"></i> SHIP UPGRADES</h2>
                        <p id="shipyard-status">Shipyard services not available in this system</p>
                        <div class="ship-shop" id="ship-upgrades">
                            <!-- Filled dynamically -->
                        </div>
                    </div>
                    <!-- System Overview Tab -->
                    <div class="panel-section overview-tab" style="display: none;">
                        <h2><i class="fas fa-globe"></i> SYSTEM OVERVIEW</h2>
                        <div class="system-overview-grid">
                            <div class="system-overview-item">
                                <h3><i class="fas fa-star"></i> Current System</h3>
                                <div id="current-system-name">-</div>
                                <div id="current-system-economy">-</div>
                                <div id="current-system-security">-</div>
                            </div>
                            <div class="system-overview-item">
                                <h3><i class="fas fa-gas-pump"></i> Fuel Status</h3>
                                <div id="overview-fuel">-</div>
                                <div id="overview-refuel-cost">-</div>
                            </div>
                            <div class="system-overview-item">
                                <h3><i class="fas fa-box"></i> Cargo Status</h3>
                                <div id="overview-cargo">-</div>
                                <div id="overview-cargo-value">-</div>
                            </div>
                            <div class="system-overview-item">
                                <h3><i class="fas fa-skull"></i> Threat Level</h3>
                                <div id="overview-threat">-</div>
                                <div id="overview-pirate-chance">-</div>
                            </div>
                        </div>
                        <h2 style="margin-top: 15px;"><i class="fas fa-satellite"></i> NEARBY SYSTEMS</h2>
                        <div id="nearby-systems">
                            <!-- Filled dynamically -->
                        </div>
                    </div>
                    <!-- Contracts Tab -->
                    <div class="panel-section contracts-tab" style="display: none;">
                        <h2><i class="fas fa-file-contract"></i> AVAILABLE CONTRACTS</h2>
                        <div id="contracts-list">
                            <!-- Filled dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="module" src="Game.js"></script>
</body>
</html>